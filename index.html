<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" http-equiv="Content-Type" content="text/html; charset=windows-1252">
		<link rel="stylesheet" href="./css/bootstrap.min.css">
		<link rel="stylesheet" href="./css/style.css">
		<script type="text/javascript" src="./js/jquery-3.1.1.min.js"></script>
  		<script type="text/javascript" src="./js/bootstrap.min.js"></script>
   		<script src="http://d3js.org/d3.v4.min.js"></script>
   		<script src="http://dimplejs.org/dist/dimple.v2.3.0.min.js"></script>
 		<script type-"text/javascript">
      /* Define initial state of variables for chart function */
      var measure = "pop_Count";
      var measure2 = "surv_Rate";
      var x_Axis = "Gender";
      var grouping = "Class";
      var class_Slice = "None";
      var gender_Slice = "None";
      var mortality_Slice = "None";
      var ageRange_Slice = ["None"]; 
      var fareRange_Slice = ["None"];
      var port_Slice = "None";
      var description_Text = "";
      var fare_Range_Order = ["0 < 30","30 < 60","60 < 90","90 < 120","120 < 150","150 < 180","180 < 210","210 < 240","240 < 270", "510 < 540"];
      var age_Range_Order = ["0 < 10","10 < 20","20 < 30","30 < 40","40 < 50","50 < 60","60 < 70","70 < 80","80 < 90","Unknown"];
      var overall_Order = ["0 < 10","0 < 30","1","10 < 20","2","20 < 30","3","30 < 40","30 < 60","40 < 50","50 < 60","60 < 70","60 < 90","70 < 80","80 < 90","90 < 120","120 < 150","150 < 180","180 < 210","210 < 240","240 < 270", "510 < 540","Unknown"];
      
      /* Variables for the animation */
      var scenarios = [{a:"b"},{a:"b"},{a:"b"},{a:"b"},{a:"b"},{a:"b"},{a:"b"}];
      var animation_Run = scenarios.length;
      var animation_Playing = false;
 		</script>
 		<style>
 			body {
 				background: #00ade6;
 				color: #FFFFFF;
 			}
 			#buttons {
 				text-align: center;
 				background: #FFFFFF;
 				color: #00ade6;
 			}
 			#chart {
 				text-align: center;
 				background: #FFFFFF;
 				color: #00ade6;
 			}
 			#end_margin {
 				text-align: center;
 				background: #FFFFFF;
 				color: #00ade6;
 			}
 			#main-body {
 				background: #FFFFFF;
 			}
      td {
        padding: 5px 5px 5px 5px;
      }
 		</style>
 	</head>
 	<body>
 		<div class="container">
 			<div class="row title-banner">
 				<div class="col-md-6 col-sm-6 col-xs-6">
 					<img class="title-logo" src="./img/Titanic-96.png">
          <!--Found at https://icons8.com/icon/42114/titanic-->
 				</div>
 				<div class="col-md-6 col-sm-6 col-xs-6 title-text text-right">
 					<h1>Joseph Jasper</h1>
 					<h3>
            Udacity Visualization Project
          </h3>
 				</div>
 			</div>
 			<div class="row" id="main-body">
        <div class="row">
          <h3 style="color:#00ade6; text-align:center;">Titanic Passenger Data Exploration</h3>
        </div>
 				<div class="col-md-2" id="buttons">
 					<span id="buttons_text" style="display: none;"></span>
 					<br>
 					<form align="center" name="measures" id="form_change">
              <!-- Maybe look at changing to bootstrap dropdowns.  http://getbootstrap.com/components/#dropdowns -->
   					<div class="row">
              <h4>Chart Controls</h4>
              <div class="col-md-12 col-sm-3 col-xs-3">
                Bar Measure
                <br>
                <select name="measure_select" onchange="measure = this.value" >
                  <option value="none" >---</option>
                  <option value="surv_Rate"  >Survival Rate</option>
        					<option value="surv_Count" >Survivor Count</option>
                  <option value="pop_Count" selected = "selected">Population Count</option>

     						</select>
     					</div>
              <div class="col-md-12 col-sm-3 col-xs-3">
                Bubble Measure
                <br>
                <select name="measure2_select" onchange="measure2 = this.value" >
                  <option value="none" >---</option>
                  <option value="surv_Rate"  selected = "selected">Survival Rate</option>
                  <option value="surv_Count" >Survivor Count</option>
                  <option value="pop_Count" >Population Count</option>
                </select>
                <br>
              </div>
              <div class="col-md-12 col-sm-3 col-xs-3">
     						X Axis
                <br>
      					<select name="x-axis" onchange = "x_Axis = this.value">
                  <option value="Total Sample">---</option>
        					<option value="Gender" selected="selected">Gender</option>
                  <option value="Class">Class</option>
        					<option value="Age Range">Age</option>
        					<option value="Fare Range">Fare</option>
        					<option value="Port">Port</option>
                  <option value="Mortality">Mortality</option>
      					</select>
              </div>
              <div class="col-md-12 col-sm-3 col-xs-3">
      					Grouping
                <br>
      					<select name="Grouping" onchange = "grouping = this.value">
        					<option value="None">---</option>
                  <option value="Gender">Gender</option>
                  <option value="Class" selected="selected">Class</option>
                  <option value="Age Range">Age</option>
                  <option value="Fare Range">Fare</option>
                  <option value="Port">Port</option>
                  <option value="Mortality">Mortality</option>
      					</select>
              </div>
            </div>
  					<hr>
            <div class="row">
              <h4 align="center">Filters</h4>
              <div class="col-md-12 col-sm-3 col-xs-3">
                Gender
                <br>
                <select name="Gender Slice" onchange = "gender_Slice = this.value">
                  <option value="None">---</option>
                  <option value="Female">Female</option>
                  <option value="Male">Male</option>
                </select>
                <br>
                Class
                <br>
                <select name="Class Slice" onchange = "class_Slice = this.value">
                  <option value="None">---</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                </select>
              </div>
              <div class="col-md-12 col-sm-3 col-xs-3">
                Port
                <br>
                <select name="Port Slice" onchange = "port_Slice = this.value">
                  <option value="None">---</option>
                  <option value="Cherbourg">Cherbourg</option>
                  <option value="Southampton">Southampton</option>
                  <option value="Queenstown">Queenstown</option>
                  <option value="Unknown">Unknown</option>
                </select>
                <br>
                Mortality
                <br>
                <select name="Mortality Slice" onchange = "mortality_Slice = this.value">
                  <option value="None">---</option>
                  <option value="Survived">Survived</option>
                  <option value="Perished">Perished</option>
                </select>
              </div>
              <div class="col-md-12 col-sm-3 col-xs-3">
                Age Range
                <br>
                <select id="age" name="Age Range Slice" onchange = "ageRangeUpdate()" multiple>
                  <option value="None" selected="selected">---</option>
                  <option value="0 < 10">0 &lt; 10</option>
                  <option value="10 < 20">10 &lt; 20</option>
                  <option value="20 < 30">20 &lt; 30</option>
                  <option value="30 < 40">30 &lt; 40</option>
                  <option value="40 < 50">40 &lt; 50</option>
                  <option value="50 < 60">50 &lt; 60</option>
                  <option value="60 < 70">60 &lt; 70</option>
                  <option value="70 < 80">70 &lt; 80</option>
                  <option value="80 < 90">80 &lt; 90</option>
                  <option value="Unknown">Unknown</option>
                </select>
                <br>
              </div>
              <div class="col-md-12 col-sm-3 col-xs-3">
                Fare Range
                <br>
                <select id="fare" name="Fare Range Slice" onchange = "fareRangeUpdate()" multiple>
                  <option value="None" selected="selected">---</option>
                  <option value="0 < 30">0 &lt; 30</option>
                  <option value="30 < 60">30 &lt; 60</option>
                  <option value="60 < 90">60 &lt; 90</option>
                  <option value="90 < 120">90 &lt; 120</option>
                  <option value="120 < 150">120 &lt; 150</option>
                  <option value="150 < 180">150 &lt; 180</option>
                  <option value="210 < 240">210 &lt; 240</option>
                  <option value="240 < 270">240 &lt; 270</option>
                  <option value="510 < 540">510 &lt; 540</option>
                </select>
                <br>
              </div>
            </div>
            <br>
					</form>
          <br>
 				</div>
 				<div class="col-md-8" id="chart">
 					<span id="chart_text" style="display: none;"></span>
 					<div class="col-md-12" id="chartContainer">
 						<script src="http://d3js.org/d3.v4.min.js"></script>
 						<script src="http://dimplejs.org/dist/dimple.v2.3.0.min.js"></script>
  						<script type="text/javascript">
                var svg = dimple.newSvg("#chartContainer", 590, 450);
                function chart_graph() {
                  d3.select("svg")
                    .selectAll("*")
                    .remove();
                  var chartGrouping = null
                  d3.csv("./data/titanic_data_post.csv",
                    function (data) {
                      /* Filter data based on slicer variables */
                      filteredData = data.filter(function(d) {
                        return (class_Slice == "None" || class_Slice == d['Class'])
                        && (gender_Slice == "None" || gender_Slice == d['Gender'])
                        && (mortality_Slice =="None" || mortality_Slice == d['Mortality'])
                        && ((ageRange_Slice[0] == "None" && ageRange_Slice.length == 1)|| ageRange_Slice.indexOf(d['Age Range']) !== -1)
                        && ((fareRange_Slice[0] == "None" && fareRange_Slice.length == 1)|| fareRange_Slice.indexOf(d['Fare Range']) !== -1)
                        && (port_Slice == "None" || port_Slice == d['Port']);
                      });

                      var myChart = new dimple.chart(svg, filteredData);
                      myChart.setBounds(60, 40, 470, 320)

                      /* Using default colors with black stroke to highlight dots over bars */
                      myChart.defaultColors = [
                        new dimple.color('#93BAD5','#000000',1),
                        new dimple.color('#FC998E','#000000',1),
                        new dimple.color('#FDC381','#000000',1),
                        new dimple.color('#C2E587','#000000',1),
                        new dimple.color('#FFF18C','#000000',1),
                        new dimple.color('#C999CA','#000000',1),
                        new dimple.color('#A4DCD2','#000000',1),
                        new dimple.color('#D6EFD1','#000000',1),
                        new dimple.color('#FFFFC2','#000000',1)
                      ];

                      /* Create functionality in case user wants to compare 2 features or just view one */
                      if (x_Axis == grouping || grouping == "None"){
                        x = myChart.addCategoryAxis("x", x_Axis);
                        x.addOrderRule(overall_Order);
                      } else { 
                        chartGrouping = grouping
                        x = myChart.addCategoryAxis("x", [x_Axis, grouping]);
                        x.addOrderRule(overall_Order);
                        x.addGroupOrderRule(overall_Order);
                      }
                      if (x_Axis == "Total Sample" && grouping !== "None") {
                        x.title = "Whole Sample by " + grouping;
                      }


                      var y;
                      /* Title and formatting control for first y axis */
                      if (measure == "surv_Count") {
                        y = myChart.addMeasureAxis("y", "Survived");
                        y.title = "Survivor Count";
                      } else if (measure == "surv_Rate") {
                        y = myChart.addMeasureAxis("y", "Survived");
                        y.overrideMax = 1.0;
                        y.tickFormat = d3.format(".0%");
                        y.title = "Survival Rate";
                      } else if (measure == "pop_Count") {
                        y = myChart.addMeasureAxis("y", "Survived");
                        y.title = "Population Count";
                      }

                      var y2;
                      /* Title and formatting control for second y axis */
                      if(measure !== measure2) {
                        if (measure2 == "surv_Count") {
                          y2 = myChart.addMeasureAxis("y", "Survived"); 
                          y2.title = "Survivor Count";
                        } else if (measure2 == "surv_Rate") {
                          y2 = myChart.addMeasureAxis("y", "Survived");
                          y2.overrideMax = 1.0;
                          y2.tickFormat = d3.format(".0%");
                          y2.title = "Survival Rate";
                        } else if (measure2 == "pop_Count") {
                          y2 = myChart.addMeasureAxis("y", "Survived");
                          y2.title = "Population Count";
                        }
                      }

                      /* Clarifying y axis titles if more than one measure selected */

                      if (measure !== "none" && measure !== measure2 && measure2 !== "none") {
                        y.title += " (bars)";
                        y2.title += " (dots)";
                      }


                      if (measure !== "none") {
                        var bars = myChart.addSeries(chartGrouping, dimple.plot.bar, [x, y]);
                        bars.addOrderRule(overall_Order);

                        /* Measure control based on selection */
                        if (measure == "surv_Rate") {
                          bars.aggregate = dimple.aggregateMethod.avg;
                        } else if (measure == "pop_Count") {
                          bars.aggregate = dimple.aggregateMethod.count;

                        }
                      }

                      if (measure2 !== "none" && measure2 !== measure) {
                        var dots = myChart.addSeries(chartGrouping, dimple.plot.bubble, [x, y2]);
                        dots.addOrderRule(overall_Order);

                        /* Measure control based on selection */
                        if (measure2 == "surv_Rate") {
                          dots.aggregate = dimple.aggregateMethod.avg;
                        } else if (measure2 == "pop_Count") {
                          dots.aggregate = dimple.aggregateMethod.count;
                        }
                      }

                      /* Evaluate need for a legend */
                      if (x_Axis !== grouping && grouping !== "None"){
                        myChart.addLegend(65, 10, 510, 20, "left");
                      }

                      myChart.draw();
                      d3.select('#variable_Description')
                        .text(description_Text);

                    }
                  );

                  /* Allow graph to change size and preserve aspect ratio depending on resizing */
                  d3.select('svg')
                    .attr('preserveAspectRatio','xMinYMin meet')
                    .attr('viewBox', '0 0 590 450')
                    .classed('svg-content-responsive', true)
                    .attr('height', null)
                    .attr('width', null);
                  
                }
                chart_graph();

  						</script>
              <span id="variable_Description"></span>
					</div>
 				</div>
 				<div class="col-md-2" id="end_margin">
 					<span id="end_margin_text" style="display: none;"></span>
          <div class="row" id="variable_Description"  align="center">
            <h4 style="color:#00ade6; text-align:center;"><a style="color:#00ade6;" href="https://www.kaggle.com/c/titanic/data">Data Dictionary</a></h4>
            <div>
              Data is a random subset of 891 of the 2224 passengers of the Titanic.
              <br>
              <br>
              <table>
                <tr>
                  <th>Variable</th>
                  <th>Definition</th>
                </tr>
                <tr>
                  <td>Gender</td>
                  <td>Male or Female</td>
                </tr>
                <tr>
                  <td>Class</td>
                  <td>Class of ticket purchased </td>
                </tr>
                <tr>
                  <td>Age</td>
                  <td>Age of passenger grouped by values of 10 years</td>
                </tr>
                <tr>
                  <td>Fare</td>
                  <td>Amount of money paid for ticket grouped by values of $30</td>
                </tr>
                <tr>
                  <td>Class</td>
                  <td>Class of ticket purchased</td>
                </tr>
                <tr>
                  <td>Port</td>
                  <td>Port of origination of the passenger</td>
                </tr>
                <tr>
                  <td>Mortality</td>
                  <td>Classification of whether the passenger survived</td>
                </tr>
                <tr>
                  <td>Population Count</td>
                  <td>Raw count of passengers</td>
                </tr>
                <tr>
                  <td>Survivor Count</td>
                  <td>Raw count of passengers that survived</td>
                </tr>
                <tr>
                  <td>Survival Rate</td>
                  <td>Survivor Count divided by Population Count</td>
                </tr>
              </table>
              <br>
            </div>
          </div>
 				</div> 				
 			</div>
 		</div>
 		<script type="text/javascript">
      /* Functions to get sizes of the main columns of the body, useful when first evaluating layout */
 			button_width = document.getElementById('buttons').offsetWidth;
 			document.getElementById("buttons_text").innerHTML = button_width;
 			chart_width = document.getElementById('chart').offsetWidth;
 			document.getElementById("chart_text").innerHTML = chart_width;
 			margin_width = document.getElementById('end_margin').offsetWidth;
 			document.getElementById("end_margin_text").innerHTML = margin_width;
 			window.addEventListener("resize",function(){
				button_width = document.getElementById("buttons").offsetWidth;
				document.getElementById("buttons_text").innerHTML = button_width;
				chart_width = document.getElementById("chart").offsetWidth;
				document.getElementById("chart_text").innerHTML = chart_width;
				margin_width = document.getElementById("end_margin").offsetWidth;
				document.getElementById("end_margin_text").innerHTML = margin_width;
 			});

      /* Listener for form to redraw the chart when user changes is selections */
      document.getElementById("form_change").addEventListener("change",
        function(event) {
            chart_graph();
            d3.selectAll('circle').style('stroke','black');
        }, false);

      /* Function to collect all options selected from the Fare Range slicer */
      function fareRangeUpdate() {
        fareRange_Slice = []
        fareArray = d3.select('#fare')['_groups'][0][0]['selectedOptions'];
        fareArrayLength = fareArray.length;
        for (i = 0; i < fareArrayLength; i++) {
          fareRange_Slice.push(fareArray[i]['value']);
        }
      }

      /* Function to collect all options selected from the Age Range slicer */
      function ageRangeUpdate() {
        ageRange_Slice = []
        ageArray = d3.select('#age')['_groups'][0][0]['selectedOptions'];
        ageArrayLength = ageArray.length;
        for (i = 0; i < ageArrayLength; i++) {
          ageRange_Slice.push(ageArray[i]['value']);
        } 
      }
      function variable_Rewrite(object) {
        measure = object.measure;
        measure2 = object.measure2;
        x_Axis = object.x_Axis;
        grouping = object.grouping;
        class_Slice = object.class_Slice;
        gender_Slice = object.gender_Slice;
        mortality_Slice = object.mortality_Slice;
        ageRange_Slice = object.ageRange_Slice;
        fareRange_Slice = object.fareRange_Slice;
        port_Slice = object.port_Slice;
        description_Text = object.description_Text;
      }

      function animate() {
        /* Capture initial state, may be useful if I add a play button */
        var initial_State = {};
        initial_State.measure = measure;
        initial_State.measure2 = measure2;
        initial_State.x_Axis = x_Axis;
        initial_State.grouping = grouping;
        initial_State.class_Slice = class_Slice;
        initial_State.gender_Slice = gender_Slice;
        initial_State.mortality_Slice = mortality_Slice;
        initial_State.ageRange_Slice = ageRange_Slice; 
        initial_State.fareRange_Slice = fareRange_Slice;
        initial_State.port_Slice = port_Slice;
        initial_State.description_Text = description_Text;

        /* Hide controls and Data Dictionary during animation */
        d3.select('#form_change')
          .style('display','none');

        d3.select('#variable_Description')
          .style('display','none');







        /* Reset variables and expose controls and Data Dictionary after animation */
        variable_Rewrite(initial_State);
        d3.select('#form_change')
          .style('display','inherit');

        d3.select('#variable_Description')
          .style('display','inherit');
      }
 		</script>
 	</body>
 </html>
